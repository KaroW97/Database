 <%- include('../partials/infoMessages.ejs') %> 

 <div class="center-main-div">
    <div class="main-div">
        <div class="content">
            <div class="visit">
                <input type="text" class="myInput myInputClient" name="name" placeholder="Szukaj Listy" autocomplete="off" >  

                <form class="find-visit"  action="/shopping-list" method="GET">
                    <input placeholder="Od" id="dataFrom" name="visitAfter" value="<%=searchOptions.visitAfter%>"  autocomplete="off"   />
                    <button type="submit"><i class="fas fa-search"></i></button>
                </form>

              <div class="flex-end">
                <button class="separate openCreateForm"><i class="fas fa-plus"></i></button><!--create list-->
                <button class="separate showForm"  href="#" ><i class="fas fa-building"></i></button><!--add new company or assign-->
                <button class="separate-last delete-brand"><i class="far fa-trash-alt"></i></button><!--delete company-->
               
              </div>
           
            </div>
        </div>
        <%-include('../partials/toggleListBrandNames.ejs')%>  
    </div>
 </div>

<div class="main-div-full-content">
    <div class="main-div-center  ">
        <div class="content-div">
            <% for(var i = 0 ; i< shopping.length ; i++){%>
                <div class="visit">
                    <form method="post" action='/shopping-list/<%=shopping[i]._id%>?_method=DELETE'>
                        <button type="submit" class="close" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </form>  
                    <div class="div-element" onclick="window.location='/shopping-list/list-view/<%=shopping[i].id%>'"  >

                        <p ><%=shopping[i].listName.name  == null? '-':shopping[i].listName.name %> </p> 
                        <p class="headerVisit">Kwota</p>
                        <p ><%=shopping[i].totalPrice== null?'-':shopping[i].totalPrice+'zł' %></p>
                        <p class="headerVisit">Transakcja</p>
                        <p><%= shopping[i].transactionDate == null ? '-' : weekdays[shopping[i].transactionDate.getDay()]+' '+shopping[i].transactionDate.toISOString().split('T')[0] %></p> 

                                         
                    </div>
                </div>   
            <%} %> 
        </div>
      
    </div>

    <div class="company-square"><p class="p-color">Zakupy</p></div>
    <div class="square-shadow"></div>
    <div class="center-shopping-list">
        <div class="shopping-list">
            <%shoppingAll.forEach(element => {%>
                <div onclick="location.href='/shopping-list/list-view/<%=element._id%>'" class="list-content">
                    <div class="date">
                        <p><%= element.transactionDate == null ? '' :   element.transactionDate.toISOString().split('T')[0] %> </p> 
                    </div>
                    <div class="shopping-price-name">
                        <div class="list-name">
                            <p class="headerVisit">Nazwa</p>
                            <p><%= element.listName.name == null ? '' :element.listName.name %> </p> 
                        </div>
                        <div  class="list-price">
                            <p class="headerVisit">Cena</p>
                            <p class="last"><%= element.totalPrice %>zł </p>
                        </div>
                       
                    </div> 
                </div>
              
            
            <%}); %>
        </div>
    
    </div>
</div>

<div class="create-visit-form  " id="visitForm">
    <form method="POST" action="/shopping-list/brand-name" class="center-form">
        <div  id ="comapnyForm" class="form">
            <!--onclick="closeForm()"-->
            <span id ="close"class="close" >&times;</span>
            <div class="form-content">
                <input id ="input"type="text" name="name" placeholder="Dodaj nazwe firmy" value="<%=brandName.name%>" required autofocus >
                <button type="submit">Dodaj</button>
               </div>
   
        </div>
    </form>
</div>

<!--Delete Hidden Form-->
<div class=" create-visit-form hide-delete" id="">
    <form action="/shopping-list/brand-name-delete?_method=DELETE" method="post" class="center-form" >
        
        <div class="button">
            <button type="submit"><i class="far fa-trash-alt"></i></button><!--delete company-->
        </div>
   
        <div  class="form">
            
            <span id ="close"class="close" >&times;</span>
            <div class="scroll">
                <div class="form-content">
                    <ul >
                        <% brandName.forEach((brand,index) => { %>
                            <div class="flex"  brand-id="<%=brand.id%>">
                                <li value="<%=brand.id%>" ><%=brand.name%></li>
                                <div class="checkbox" >
                                    
                                    <input type="checkbox" id="checkbox-delete-<%=index%>"name="chackboxDeleteBrand" value="<%=brand.id%>" >
                                    <label for="checkbox-delete-<%=index%>"></label>
                                
                                </div>
                                
                            </div>
                        
                        <%}); %>
                    </ul>
                </div>
            </div>    
        </div>
    </form>
</div>

<footer class='footer'>
    <p>Copyright ® All rights reserved 2020  Karolina Wiaderek </p>
</footer>


<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<script src="https://unpkg.com/gijgo@1.9.13/js/gijgo.min.js" type="text/javascript"></script>
<script src="../../public/dataTimePicker.js"></script>
<script>
    $(document).ready(function(){
      $('.myInputClient').on('keyup click', function () {
            let value = $(this).val().toLowerCase();
           
            $('.main-div-full-content .visit ').filter(function(){
                $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
            })

        })
        //if clients list clicked toggle visits
        $('.clients-list').on('click',function(){
            let value = $('.myInputClient').val().toLowerCase();
           
            $('.main-div-full-content .visit ').filter(function(){
                $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
           
            })  
        })

        $('.delete-brand').click(function(){
            $('.hide-delete').show()
        })
        $('.close').click(function(){
            $('.hide-delete').hide()
        })
        $('.flex  ').click(function(){
            console.log($(this).attr('brand-id'))
           // $('.felx .checkbox input').attr('checked','checked')
            console.log( $('.flex .checkbox  input').attr('value'))
           // if($(this).attr('brand-id') == )
           // console.log( $('.checkbox input[type="checkbox"]').attr('checked',true))
        })
     
    })
</script>