<%-include('../partials/infoMessages.ejs')%>
<%-include('../partials/arrayMessage.ejs')%>


<div id="top" class="center-main-div">
    <div class="main-div">
        <div class="content">
            <div class="visit">
                    <form class="find-visit"  action="/calendar" method="GET">
                            <div class="data-input-from">
                                <input placeholder="Od" id="dataFrom" name="visitAfter"   autocomplete="off" value="<%=searchOptions.visitAfter%>"  />
                            </div>
                            <div class="data-input-to">
                                <input placeholder="Do" id="dataTo"  name="visitBefore"   autocomplete="off" value="<%=searchOptions.visitBefore%>" />
                            </div>
                            <div class="search">
                                <button type="submit" class="search-button"><i class="fas fa-search"></i></button>
                            </div>

                       

                    </form>
                    <div class="add">
                        <button class="button_action showForm " ><i class="fas fa-plus"></i></button>
                    </div>
            <!--onclick="showFormm()"-->
            </div>
        </div>
    </div>
</div>
<div class="create-visit-form toggleListHide " id="visitForm">
    <form method="POST" action="/calendar/visit" class="center-form">
        <div  id ="comapnyForm" class="form">
            <!--onclick="closeForm()"-->
            <span id ="close"class="close" >&times;</span>
            <div class="form-content">
              
                <div class = "ui-widget ">
                    <input  class="myInput inputCreate automplete-3" type="text" name ="clients" placeholder="Nazwa Klienta"  autocomplete="off" required>
                 </div>
                <input class="phone" name="phone" type="phone" placeholder="Numer Telefonu"  autocomplete="off" minlength="9" required>
                <div class = "ui-widget ">
                    <input  class="myInput inputCreateTreatment " type="text" name ="treatment" placeholder="Nazwa Zabiegu"  autocomplete="off" required>
                 </div>
                <input  id="datapickerAdd"  name ="visitDate"  placeholder="Data"  autocomplete="off"  required/>
                <input   id="timepickerFrom" onclick="$timepickerFrom.open()" name="timeFrom"   placeholder="Czas rozpoczęcia" value="<%=newVisit.timeFrom  %>" autocomplete="off" required />
                <input   id="timepickerTo"onclick="$timepickerTo.open()"name="timeTo"  placeholder="Czas zakończenia" value="<%=newVisit.timeTo  %>" autocomplete="off" />

                <button type="submit">Dodaj</button>
                <div class="clients-list create">
                    <ul class="list-client list"  >
                        <% clients.forEach(client => { %>
                            <li value="<%=client.id%>" phone="<%=client.phoneNumber%>" ><%=client.name%> <%=client.lastName%></li>
                        <%}); %>
                    </ul>
                </div>    
                <div class="treatments-list create">
                    <ul class="listTreatment list"  >
                        <% treatments.forEach(treatment => { %>
                            <li value="<%=treatment._id%>"><%=treatment.treatmentName%></li>
                        <%}); %>
                    </ul>
                </div>
                
            </div>
   
        </div>
    </form>
</div>
<div class="create-visit-form toggleListHide openForm ">
    <form method="POST" class="formEdit center-form" action="" >
        <div id ="openForm" class="form" >
            <span class="close closeEdit" onclick="closeForm()">&times;</span>
            <div class="form-content">
                <div class = "ui-widget ">
                    <input  class="myInput inputEdit" type="text" name ="clients" placeholder="Nazwa Klienta"  autocomplete="off" required>
                 </div>
                <input class="phone" name="phone" type="phone" placeholder="Numer Telefonu"  autocomplete="off" minlength="9" required>
                <div class = "ui-widget ">
                    <input  class=" inputEditTreatment " type="text" name ="treatment" placeholder="Nazwa Zabiegu"  autocomplete="off" required>
                 </div>
                <input placeholder="Data"  class="visitDateEdit"  id="datapickerAddEdit" name="visitDateEdit"   autocomplete="off"   required/>
                <input id="timepickerFromEdit" class="timeFrom"onclick="$timepickerFromEdit.open()" name="timeFromEdit"  placeholder="Czas rozpoczęcia"  autocomplete="off" required/>
                <input id="timepickerToEdit" class="timeTo" onclick="$timepickerToEdit.open()"name="timeToEdit"  placeholder="Czas zakończenia" autocomplete="off" />
                
                <button class="button"type="submit">Edytuj</button>
             
                 </div>
  
        </div>
    </form>

</div>
<div class="main-div-full-content">
    <div class="main-div-center  ">
        <div class="content-div">
            
            <% for(var i = 0 ; i< newVisit.length ; i++){%>
                <div class="visit">
                    <form method="post" action='/calendar/<%=newVisit[i]._id%>?_method=DELETE'>
                        <button type="submit" class="close" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </form>  
                    <div class="div-element"  
                    client ="<%= newVisit[i].clientName%> " 
                    treatment="<%= newVisit[i].treatment %>",
                    visitDate ="<%=newVisit[i].visitDate.toISOString().split('T')[0]%>",
                    timeFrom="<%= newVisit[i].timeFrom %>",
                    timeTo="<%=newVisit[i].timeTo%>",
                    phone ="<%= newVisit[i].phoneNumber%>",
                    action="/calendar/edit/<%=newVisit[i]._id%>?_method=PUT"
                    >

                        <p class="header"><%= newVisit[i].visitDate == null ? '' : `${weekdays[newVisit[i].visitDate.getDay()] } ${ newVisit[i].visitDate.toISOString().split('T')[0]}` %> </p> 
                        <div class="first-p-element">
                            <p class="headerVisit">Klient</p>
                            <p ><%= newVisit[i].clientName %></p>
                        </div>
                        <div class="sec-p-element">
                            <p class="headerVisit">Telefon</p>
                            <p><%= newVisit[i].phoneNumber%></p> 
                        </div>
                        <div class="th-p-element">
                            <p class="headerVisit">Zabieg</p>
                            <p><%= newVisit[i].treatment%> </p>
                        </div>
                        <div class="fourth-p-element">
                            <p class="headerVisit">Godzina</p> 
                            <p  ><%= newVisit[i].timeFrom %> - <%=newVisit[i].timeTo%>  </p>  
                        </div>                        
                    </div>
                </div>   
            <%} %> 
         
        </div>
    </div>

</div>
<div class="anchor" onclick="location.href='#shopping-list'">
    <a class="anchor-button" ><i class="fas fa-caret-down"></i></a>
</div>
<div id="shopping-list" class="shopping-list-out">
    <div class="company-square" clicked="false"><p class="p-color">Zakupy</p></div>
    <div class="square-shadow"></div>
    <div class="center-shopping-list">
        <div class="shopping-list">
            <%shoppingAll.forEach(element => {%>
                <div onclick="location.href='/shopping-list/list-view/<%=element._id%>'" class="list-content">
                    <div class="date">
                        <p><%= element.transactionDate == null ? '' : element.transactionDate.toISOString().split('T')[0] %> </p> 
                    </div>
                    <div class="shopping-price-name">
                        <div class="list-name">
                            <p class="headerVisit">Nazwa</p>
                            <p><%= element.listNameNew != undefined ? element.listNameNew :element.listName.name %> </p> 
                        </div>
                        <div  class="list-price">
                            <p class="headerVisit">Cena</p>
                            <p class="last"><%= element.totalPrice %>zł </p>
                        </div>
                    
                    </div> 
                </div>
            
            
            <%}); %>
        </div>

    </div>
</div>


<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<script src="https://unpkg.com/gijgo@1.9.13/js/gijgo.min.js" type="text/javascript"></script>

<script src="../../public/dataTimePicker.js"></script>
<script src="../../public/js/calendar.js"></script>


<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<script>
    var clientsCreate = []
    $('.create .list-client li').filter(function(){
        clientsCreate.push({value:$(this).text(),phone:$(this).attr('phone') })
    })
    var treatmentCreate = []
    $('.create .listTreatment li').filter(function(){
        treatmentCreate.push($(this).text())
    })
   
    $(function(){
        $( ".inputEdit" ).autocomplete({
            source: clientsCreate,
            autoFocus:true,
            classes: {
                "ui-menu": "highlight"
            },
            select: function(e, ui){
                $('.phone').val(ui.item.phone)
            }
        });
    })
    $(function(){
        $( ".automplete-3" ).autocomplete({
            source: clientsCreate,
            autoFocus:true,
            classes: {
                "ui-menu": "highlight"
            },
            select: function(e, ui){
                $('.phone').val(ui.item.phone)
            }
        });
    })
    $(function(){
        $( ".inputCreateTreatment" ).autocomplete({
            source: treatmentCreate,
            autoFocus:true,
            classes: {
                "ui-menu": "highlight"
            }
        });
    })
    $(function(){
        $( ".inputEditTreatment" ).autocomplete({
            source: treatmentCreate,
            autoFocus:true,
            classes: {
                "ui-menu": "highlight"
            }
        });
    })
   
</script>