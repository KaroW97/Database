<%-include('../partials/infoMessages.ejs')%>
<%-include('../partials/arrayMessage.ejs')%>
<div class="center-main-div">
    <div class="main-div">
        <div class="content">
            <div class="visit">
                    <form class="find-visit"  action="/calendar" method="GET">
                        <input placeholder="Od" id="dataFrom" name="visitAfter"   autocomplete="off" value="<%=searchOptions.visitAfter%>"  />
                        <input placeholder="Do" id="dataTo"  name="visitBefore"   autocomplete="off" value="<%=searchOptions.visitBefore%>" />
                        <button type="submit"><i class="fas fa-search"></i></button>
                    </form>
            <!--onclick="showFormm()"-->
                <button class="button_action showForm" ><i class="fas fa-plus"></i></button>
            </div>
    
               
        
        </div>
    </div>
</div>
<div class="create-visit-form toggleListHide " id="visitForm">
    <form method="POST" action="/calendar/visit" class="center-form">
        <div  id ="comapnyForm" class="form">
            <!--onclick="closeForm()"-->
            <span id ="close"class="close" >&times;</span>
            <div class="form-content">
                
                <%-include('./newVisit-editVisit.ejs')%>
                <input  id="datapickerAdd"  name ="visitDate"  placeholder="Data"  autocomplete="off"  required/>
                <input   id="timepickerFrom" onclick="$timepickerFrom.open()" name="timeFrom"   placeholder="Czas rozpoczęcia" value="<%=newVisit.timeFrom  %>" autocomplete="off" required />
                <input   id="timepickerTo"onclick="$timepickerTo.open()"name="timeTo"  placeholder="Czas zakończenia" value="<%=newVisit.timeTo  %>" autocomplete="off" />

                <button type="submit">Dodaj</button>
                <%-include('../partials/toogleListClients.ejs')%>         
                <%-include('../partials/toogleListTreatments.ejs')%>  
               </div>
   
        </div>
    </form>
</div>
<div class="main-div-full-content">
    <div class="main-div-center  ">
        <div class="content-div">
            <% for(var i = 0 ; i< newVisit.length ; i++){%>
                <div class="visit">
                    <form method="post" action='/calendar/<%=newVisit[i]._id%>?_method=DELETE'>
                        <button type="submit" class="close" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </form>  
                    <div class="div-element"  
                    client ="<%= newVisit[i].client != undefined ? newVisit[i].client.name :newVisit[i].newClient %> <%= newVisit[i].client != undefined? newVisit[i].client.lastName :'' %>" 
                    clientId="<%=newVisit[i].client!= null ?newVisit[i].client._id:newVisit[i].newClient%>",
                    treatment="<%= newVisit[i].treatment== null?newVisit[i].newTreatment:newVisit[i].treatment.treatmentName %>",
                    treatmentId="<%= newVisit[i].treatment!= null?newVisit[i].treatment._id:newVisit[i].newTreatment %>",
                    visitDate ="<%=newVisit[i].visitDate.toISOString().split('T')[0]%>",
                    timeFrom="<%= newVisit[i].timeFrom %>",
                    timeTo="<%=newVisit[i].timeTo%>",
                    phone ="<%= newVisit[i].phoneNumber%>",
                    visitIdd="<%=newVisit[i]._id%>",
                    newId="<%=newVisit[i]._id%>",
                    clientState="<%= newVisit[i].clientState%>",
                    treatmentState="<%= newVisit[i].treatmentState%>"
                    action="/calendar/edit/<%=newVisit[i]._id%>?_method=PUT"

                    >
                        <p ><%= newVisit[i].visitDate == null ? '' : `${weekdays[newVisit[i].visitDate.getDay()] } ${ newVisit[i].visitDate.toISOString().split('T')[0]}` %> </p> 
                        <p class="headerVisit">Klient</p>
                        <p ><%= newVisit[i].client != undefined ? newVisit[i].client.name :newVisit[i].newClient %> <%= newVisit[i].client != undefined? newVisit[i].client.lastName :'' %></p>
                        <p class="headerVisit">Telefon</p>
                        <p><%= newVisit[i].phoneNumber%></p> 
                        <p class="headerVisit">Zabieg</p>
                        <p><%= newVisit[i].treatment== null?newVisit[i].newTreatment:newVisit[i].treatment.treatmentName %> </p>
                        <p class="headerVisit">Godzina</p> 
                        <p  ><%= newVisit[i].timeFrom %> - <%=newVisit[i].timeTo%>  </p>                          
                    </div>
                </div>   
            <%} %> 
        </div>
      
    </div>

    <div class="company-square"><p class="p-color">Zakupy</p></div>
    <div class="square-shadow"></div>
    <div class="center-shopping-list">
        <div class="shopping-list">
            <%shoppingAll.forEach(element => {%>
                <div onclick="location.href='/shopping-list/list-view/<%=element._id%>'" class="list-content">
                    <div class="date">
                        <p><%= element.transactionDate == null ? '' : element.transactionDate.toISOString().split('T')[0] %> </p> 
                    </div>
                    <div class="shopping-price-name">
                        <div class="list-name">
                            <p class="headerVisit">Nazwa</p>
                            <p><%= element.listName.name == null ? '' :element.listName.name %> </p> 
                        </div>
                        <div  class="list-price">
                            <p class="headerVisit">Cena</p>
                            <p class="last"><%= element.totalPrice %>zł </p>
                        </div>
                       
                    </div> 
                </div>
              
            
            <%}); %>
        </div>
    
    </div>
</div>


<div class="create-visit-form toggleListHide openForm ">
    <form method="POST" class="formEdit center-form " action="" >
        <div id ="openForm" class="form" >
            <span class="close closeEdit" onclick="closeForm()">&times;</span>
            <div class="form-content">
                <%-include('./newVisit-editVisit.ejs')%>
                <input placeholder="Data"  class="visitDateEdit"  id="datapickerAddEdit" name="visitDateEdit"   autocomplete="off"   required/>
                <input id="timepickerFromEdit" class="timeFrom"onclick="$timepickerFromEdit.open()" name="timeFromEdit"  placeholder="Czas rozpoczęcia"  autocomplete="off" required/>
                <input id="timepickerToEdit" class="timeTo" onclick="$timepickerToEdit.open()"name="timeToEdit"  placeholder="Czas zakończenia" autocomplete="off" />
                
                <button class="button"type="submit">Edytuj</button>
                <%-include('../partials/toogleListClients.ejs')%>       
                <%-include('../partials/toogleListTreatments.ejs')%>  
                 </div>
  
        </div>
    </form>
</div>

 
<footer class='footer'>
    <p>Copyright ® All rights reserved 2020  Karolina Wiaderek </p>
</footer>

<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<script src="https://unpkg.com/gijgo@1.9.13/js/gijgo.min.js" type="text/javascript"></script>
<script src="../../public/dataTimePicker.js"></script>
<script>

</script>